<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Galerie Cloudinary</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
    .gallery img { width: 100%; border-radius: 10px; cursor: pointer; transition: transform 0.3s; }
    .gallery img:hover { transform: scale(1.05); }
  </style>
</head>
<body>

<header>
  <h1>Galerie</h1>
  <nav>
    <button onclick="loadGallery('miniatures')">Miniatures jeu de rôle</button>
    <button onclick="loadGallery('figurines')">Figurines</button>
    <button onclick="loadGallery('commissions')">Commissions</button>
  </nav>
</header>

<div class="gallery" id="gallery"></div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <span class="close" onclick="closeLightbox()">&times;</span>
  <img id="lightbox-img" src="" alt="">
  <p class="caption" id="lightbox-caption"></p>
</div>

<script>
  const cloudName = "dx0mbjcva"; // ← remplace par ton cloud_name
  const gallery = document.getElementById("gallery");
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");
  const lightboxCaption = document.getElementById("lightbox-caption");

  // Charger une galerie à partir d’un tag
  function loadGallery(tag) {
    gallery.innerHTML = "<p style='text-align:center'>Chargement...</p>";
    fetch(`https://res.cloudinary.com/${cloudName}/image/list/${tag}.json`)
      .then(res => res.json())
      .then(data => {
        gallery.innerHTML = "";
        data.resources.forEach(img => {
          const imgUrl = `https://res.cloudinary.com/${cloudName}/image/upload/w_600,q_auto,f_auto/${img.public_id}.${img.format}`;
          const fullUrl = `https://res.cloudinary.com/${cloudName}/image/upload/${img.public_id}.${img.format}`;
          const el = document.createElement("img");
          el.src = imgUrl;
          el.loading = "lazy"; // lazy loading
          el.alt = img.public_id.split("/").pop();
          el.addEventListener("click", () => openLightbox(fullUrl, el.alt));
          gallery.appendChild(el);
        });
      })
      .catch(err => {
        gallery.innerHTML = "<p style='color:red;text-align:center'>Erreur de chargement des images.</p>";
        console.error(err);
      });
  }

  // Ouvrir la lightbox
  function openLightbox(src, caption) {
    lightbox.style.display = "flex";
    lightboxImg.src = src;
    lightboxCaption.textContent = caption;
  }

  // Fermer la lightbox
  function closeLightbox() {
    lightbox.style.display = "none";
    lightboxImg.src = "";
  }

  // Charger une catégorie par défaut
  loadGallery("miniatures");
</script>

</body>
</html>
